services:

  # disco listening on an ipv6 address
  thor-disco:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: thor-disco
    hostname: thor-disco
    entrypoint: 'disco'
    command:
      - --keyhex=99f0500549792796c14fed62011a51081dc5b5e68fe8bd8a13b86be829c4fd36
      - --verbosity=4
      - --addr=[::]:55555 # enable an ipv6 listener address
    networks:
      node-network:
        ipv4_address: 172.20.1.13
        ipv6_address: 2003:abcd:1::13

  # new code with node (1) listening on ipv6
  node-1:
    hostname: node-1
    container_name: node-1
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8669:8669"
      - "11235:11235"
    command:
      - --network=/home/thor/config/genesis.json
      - --config-dir=/home/thor/keys
      - --api-addr=0.0.0.0:8669
      - --p2p-port=11235
      - --enable-p2p-ipv6
      - --bootnode=enode://e32e5960781ce0b43d8c2952eeea4b95e286b1bb5f8c1f0c9f09983ba7141d2fdd7dfbec798aefb30dcd8c3b9b7cda8e9a94396a0192bfa54ab285c2cec515ab@[2003:abcd:1::13]:55555
      - --verbosity=5
    networks:
      node-network:
        ipv4_address: 172.20.1.10
        ipv6_address: 2003:abcd:1::10
    volumes:
      - ./test/network/keys/node-1:/home/thor/keys
      - ./test/network/genesis:/home/thor/config

  # new code with node (2) listening on ipv6
  node-2:
    hostname: node-2
    container_name: node-2
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8670:8669"
      - "11236:11235"
    command:
      - --network=/home/thor/config/genesis.json
      - --config-dir=/home/thor/keys
      - --api-addr=0.0.0.0:8669
      - --p2p-port=11235
      - --enable-p2p-ipv6
      - --bootnode=enode://e32e5960781ce0b43d8c2952eeea4b95e286b1bb5f8c1f0c9f09983ba7141d2fdd7dfbec798aefb30dcd8c3b9b7cda8e9a94396a0192bfa54ab285c2cec515ab@[2003:abcd:1::13]:55555
      - --verbosity=5
    networks:
      node-network:
        ipv4_address: 172.20.1.11
        ipv6_address: 2003:abcd:1::11
    volumes:
      - ./test/network/keys/node-2:/home/thor/keys
      - ./test/network/genesis:/home/thor/config

  # old code with node listening on ipv4
  node-old-image:
    hostname: node-3
    container_name: node-3
    image: vechain/thor:v2.3.1
    ports:
      - "8671:8669"
      - "11237:11235"
    command:
      - --network=/home/thor/config/genesis.json
      - --config-dir=/home/thor/keys
      - --api-addr=0.0.0.0:8669
      - --p2p-port=11235
      - --bootnode=enode://e32e5960781ce0b43d8c2952eeea4b95e286b1bb5f8c1f0c9f09983ba7141d2fdd7dfbec798aefb30dcd8c3b9b7cda8e9a94396a0192bfa54ab285c2cec515ab@[2003:abcd:1::13]:55555
      - --verbosity=5
    networks:
      node-network:
        ipv4_address: 172.20.1.12
        ipv6_address: 2003:abcd:1::12
    volumes:
      - ./test/network/keys/node-3:/home/thor/keys
      - ./test/network/genesis:/home/thor/config

networks:
  node-network:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
        - subnet: 172.20.1.0/24
          gateway: 172.20.1.1
        - subnet: 2003:abcd:1::/64
          gateway: 2003:abcd:1::1

